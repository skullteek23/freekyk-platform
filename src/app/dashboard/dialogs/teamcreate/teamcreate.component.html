<mat-toolbar
  color="primary"
  class="mat-elevation-z4"
  fxLayoutAlign="start center"
  fxLayoutGap="16px"
>
  <button mat-icon-button mat-dialog-close (click)="onCloseDialog()">
    <mat-icon class="material-icons-round"> close </mat-icon>
  </button>
  <span class="mat-body-1">Create a New Team</span>
</mat-toolbar>
<div class="container-2">
  <div ngClass.lt-md="dialogData" ngClass.gt-sm="stepdata">
    <mat-vertical-stepper #stepper [linear]="true">
      <mat-step
        [stepControl]="teamBasicinfoForm"
        label="Fill Basic Details"
        [state]="state1"
        [completed]="state1 == 'complete'"
        [hasError]="error"
      >
        <form
          [formGroup]="teamBasicinfoForm"
          fxLayout="column"
          fxLayoutGap="16px"
          (ngSubmit)="onSubmitOne()"
        >
          <mat-form-field appearance="outline" color="primary">
            <mat-label>Enter Team Name</mat-label>
            <input type="text" matInput name="tName" formControlName="tName" />
            <mat-error *ngIf="teamBasicinfoForm.get('tName').errors?.nameTaken">
              Team name is already taken! Please choose another name
            </mat-error>
            <mat-error
              *ngIf="teamBasicinfoForm.get('tName').hasError('required')"
            >
              This field can't be empty
            </mat-error>
            <mat-error
              *ngIf="teamBasicinfoForm.get('tName').hasError('pattern')"
            >
              Only letters and numbers are allowed
            </mat-error>
          </mat-form-field>
          <div
            fxLayout="column"
            fxLayoutGap="8px"
            fxLayoutAlign="stretch start"
          >
            <button
              type="button"
              (click)="fileInputImage.click()"
              class="buttonText secondaryButton"
            >
              Upload Team Photo
            </button>
            <input
              hidden
              type="file"
              name="fileInput1"
              accept="image/*"
              #fileInputImage
              (change)="onChooseTeamImage($event)"
              id="file1"
            />
            <button
              type="button"
              (click)="fileInputLogo.click()"
              class="buttonText secondaryButton"
            >
              Upload Team Logo
            </button>
            <input
              hidden
              type="file"
              name="fileInput2"
              accept="image/*"
              #fileInputLogo
              (change)="onChooseTeamLogoImage($event)"
              id="file2"
            />
            <!-- <button
              [disabled]="!file1Selected || !file2Selected"
              (click)="onSaveImages()"
              class="primaryButton buttonText"
              type="submit"
            >
              Save Changes
            </button> -->
          </div>
          <button
            [disabled]="!teamBasicinfoForm.valid || error"
            type="submit"
            class="primaryButton buttonText"
          >
            Next
          </button>
          <p class="mat-caption left">
            By tapping “Next” above, you acknowledge that you have read and
            understood, and agree to
            <a [routerLink]="['/terms']">Freekyk Team Rules & Regulations</a>.
          </p>
        </form>
      </mat-step>
      <mat-step
        [editable]="false"
        label="Invite Players to your team"
        [state]="state2"
      >
        <div class="content_container" fxLayout="column" fxLayoutGap="16px">
          <app-search-lg
            searchPlaceholder="Search players by name, playing position, city"
            (searchItem)="filterTerm = $event"
          >
          </app-search-lg>

          <mat-hint
            *ngIf="
              pl_sel.selectedOptions.selected.length < 8 ||
              pl_sel.selectedOptions.selected.length > 15
            "
          >
            Please select atleast 8 players and atmost 15 players to invite
          </mat-hint>
          <mat-selection-list dense color="primary" #pl_sel>
            <i *ngIf="noPlayers">
              Currently, there are no players available to join any team! Please
              try again later
            </i>

            <mat-list-option
              [value]="{ name: player.name, id: player.id }"
              *ngFor="
                let player of players$
                  | async
                  | filterList: 'name,locCity,pl_pos':filterTerm
              "
            >
              <div fxLayoutAlign="space-between center" fxLayoutGap="4px">
                <span ngClass.gt-sm="mat-body-1" ngClass.lt-md="mat-caption">
                  {{
                    player.name
                      | textShorten: 15
                      | namePositionCombo: player.pl_pos
                  }}
                </span>
                <a
                  target="_blank"
                  [routerLink]="['/p', player.id]"
                  class="material-icons-round"
                >
                  open_in_new
                </a>
              </div>
            </mat-list-option>
          </mat-selection-list>

          <button
            type="button"
            (click)="onSubmitTwo(pl_sel.selectedOptions.selected)"
            [disabled]="
              pl_sel.selectedOptions.selected.length < 8 ||
              pl_sel.selectedOptions.selected.length > 15 ||
              error
            "
            class="primaryButton buttonText"
          >
            Next
          </button>
        </div>
      </mat-step>
      <mat-step label="Done">
        <div class="fin_cont" fxLayout="column" fxLayoutGap="16px">
          <ng-template #spinner>
            <app-loading></app-loading>
          </ng-template>
          <app-tick-animation
            *ngIf="success; else spinner"
          ></app-tick-animation>
          <p class="mat-body-1 center">
            You're now {{ teamBasicinfoForm.value.tName + "'s" }} Captain!
          </p>

          <div fxLayoutAlign.gt-sm="center center" fxLayout.lt-md="column">
            <button
              (click)="onCloseDialog(true)"
              class="primaryButton buttonText"
            >
              Finish
            </button>
          </div>
        </div>
      </mat-step>

      <!-- overriding icons -->
      <ng-template matStepperIcon="details">
        <mat-icon class="material-icons-round"> text_snippet </mat-icon>
      </ng-template>

      <ng-template matStepperIcon="invites">
        <mat-icon class="material-icons-round"> send </mat-icon>
      </ng-template>
      <ng-template matStepperIcon="complete">
        <mat-icon class="material-icons-round"> close </mat-icon>
      </ng-template>
    </mat-vertical-stepper>
  </div>
</div>

<mat-toolbar color="primary" class="mat-elevation-z4" fxLayoutAlign="start center" fxLayoutGap="16px">
  <button mat-icon-button mat-dialog-close (click)="onCloseDialog()">
    <mat-icon class="material-icons-round"> close </mat-icon>
  </button>
  <span class="mat-body-1">Create a New Team</span>
</mat-toolbar>
<div class="container-2">
  <div ngClass.lt-md="dialogData" ngClass.gt-sm="stepdata">
    <mat-vertical-stepper #stepper [linear]="true">
      <mat-step [stepControl]="teamBasicinfoForm" label="Fill Basic Details" [state]="state1"
        [completed]="teamBasicinfoForm.valid && isStepOneComplete" [hasError]="error">
        <form [formGroup]="teamBasicinfoForm" fxLayout="column" fxLayoutGap="16px" (ngSubmit)="onSubmitOne()">
          <mat-form-field appearance="outline" color="primary">
            <mat-label>Enter Team Name</mat-label>
            <input type="text" matInput name="tName" formControlName="tName" />
            <mat-error *ngIf="teamBasicinfoForm.get('tName').errors?.nameTaken">
              Team name is already taken! Please choose another name
            </mat-error>
            <mat-error *ngIf="teamBasicinfoForm.get('tName').hasError('required')">
              This field can't be empty
            </mat-error>
            <mat-error *ngIf="teamBasicinfoForm.get('tName').hasError('pattern')">
              Only letters and numbers are allowed
            </mat-error>
          </mat-form-field>
          <div fxLayout="column" fxLayoutGap="8px" fxLayoutAlign="stretch start">
            <button type="button" (click)="fileInputImage.click()" class="buttonText secondaryButton">
              Upload Team Photo
            </button>
            <input hidden type="file" name="fileInput1" accept="image/*" #fileInputImage
              (change)="onChooseTeamImage($event)" id="file1" />
            <button type="button" (click)="fileInputLogo.click()" class="buttonText secondaryButton">
              Upload Team Logo
            </button>
            <input hidden type="file" name="fileInput2" accept="image/*" #fileInputLogo
              (change)="onChooseTeamLogoImage($event)" id="file2" />
            <!-- <button
              [disabled]="!file1Selected || !file2Selected"
              (click)="onSaveImages()"
              class="primaryButton buttonText"
              type="submit"
            >
              Save Changes
            </button> -->
          </div>
          <button [disabled]="!teamBasicinfoForm.valid || error" type="submit" class="primaryButton buttonText">
            Next
          </button>
          <p class="mat-caption left">
            By tapping “Next” above, you acknowledge that you have read and
            understood, and agree to
            <a [routerLink]="['/terms']">Freekyk Team Rules & Regulations</a>.
          </p>
        </form>
      </mat-step>
      <mat-step [editable]="false" label="Invite Players to your team" [state]="state2" [completed]="isStepTwoComplete">
        <div *ngIf="isStepOneComplete" class="content_container" fxLayout="column" fxLayoutGap="16px">

          <div fxLayout="column" fxLayoutGap="16px">
            <app-search-autocomplete [isDisabled]="noPlayers" [options]="(players$ | async)"
              placeholder="Type any name or playing position" (selectionChange)="onAddSelection($event)">
            </app-search-autocomplete>
            <span class="mat-body-2 left">
              {{selectedPlayers.length}}/8 players
            </span>
          </div>
          <mat-hint *ngIf="selectedPlayers.length > 15">
            Maximum players selected!
          </mat-hint>
          <mat-list class="list" dense color="primary">
            <i *ngIf="noPlayers">
              Currently, there are no players available to join any team! Please
              try again later
            </i>

            <mat-list-item *ngFor="let player of selectedPlayers; let i = index">
              <div fxLayoutAlign="space-between center" fxLayoutGap="4px" class="selection-container">
                <span ngClass.gt-sm="mat-body-1" ngClass.lt-md="mat-caption">
                  {{ player.viewValue | textShorten: 50 }}
                </span>
                <div fxLayoutAlign="center center" fxLayoutGap="16px">
                  <a class="material-icons-round remove-icon" matTooltip="remove"
                    (click)="onRemoveSelection(i)">delete</a>
                  <a target="_blank" matTooltip="Open player profile" [routerLink]="['/p', player.data.id]"
                    class="material-icons-round">
                    open_in_new
                  </a>
                </div>
              </div>
            </mat-list-item>
          </mat-list>

          <button type="button" (click)="onSubmitTwo(selectedPlayers)" [disabled]="
              selectedPlayers.length < 8 ||
              selectedPlayers.length > 15 ||
              error
            " class="primaryButton buttonText">
            Next
          </button>
        </div>
      </mat-step>
      <mat-step label="Done">
        <div *ngIf="isStepOneComplete && isStepTwoComplete" class="fin_cont" fxLayout="column" fxLayoutGap="16px">
          <ng-template #spinner>
            <app-loading></app-loading>
          </ng-template>
          <app-tick-animation *ngIf="success; else spinner"></app-tick-animation>
          <p class="mat-body-1 center">
            You're now {{ teamBasicinfoForm.value.tName + "'s" }} Captain!
          </p>

          <div fxLayoutAlign.gt-sm="center center" fxLayout.lt-md="column">
            <button (click)="onCloseDialog(true)" class="primaryButton buttonText">
              Finish
            </button>
          </div>
        </div>
      </mat-step>

      <!-- overriding icons -->
      <ng-template matStepperIcon="details">
        <mat-icon class="material-icons-round"> text_snippet </mat-icon>
      </ng-template>

      <ng-template matStepperIcon="invites">
        <mat-icon class="material-icons-round"> send </mat-icon>
      </ng-template>
      <ng-template matStepperIcon="complete">
        <mat-icon class="material-icons-round"> close </mat-icon>
      </ng-template>
    </mat-vertical-stepper>
  </div>
</div>
